import macro, stringify, InjectedCode from "./example2"

@macro
func debug<T>(value: T): InjectedCode {
    val c = InjectedCode.new()
    val str = stringify(value)

    c.append("(")
    c.append("if true {\n")
    c.append("  val exp = $str\n")
    c.append("  stdoutWriteln(\"$str = \$$str\")\n")
    c.append("  exp")
    c.append("} else unreachable(\"will get optimized away\")")
    c.append(")")

    c
}

val x = 123
val y = 456
val z = debug(x) + debug(y)
stdoutWriteln("z: $z")
