type Person {
  name: String
  age: Int
}

// Test raw construction of set
(() => {
  val set: Set<Int> = Set.new()
  set.insert(1)
  set.insert(2)
  set.insert(3)
  set.insert(3)

  /// Expect: 3
  printlnv2(set.size)
  /// Expect: #{1, 2, 3}
  printlnv2(set)
})()

// Test set literal construction
(() => {
  // Primitives
  val set1 = #{1, 2, 3, 3}

  /// Expect: 3
  printlnv2(set1.size)
  /// Expect: #{1, 2, 3}
  printlnv2(set1)

  // Objects
  val set2 = #{
    Person(name: "Foo", age: 100),
    Person(name: "Boo", age: 101),
    Person(name: "Goo", age: 102),
    Person(name: "Boo", age: 101),
  }
  /// Expect: 3
  printlnv2(set2.size)
  /// Expect: #{Person(name: "Goo", age: 102), Person(name: "Foo", age: 100), Person(name: "Boo", age: 101)}
  printlnv2(set2)
})()

// == operator (also Set#eq)
(() => {
  val set = #{1, 2, 3}

  /// Expect: true
  printlnv2(set == #{1, 2, 3})
  /// Expect: true
  printlnv2(#{[1, 2], [3, 4]} == #{[3, 4], [1, 2]})

//   /// Expect: false
//   printlnv2(set == ["a", "b"])
//   /// Expect: false
//   printlnv2(set == "ab")
//   /// Expect: false
//   printlnv2(set == 123)
//   /// Expect: false
//   printlnv2(set == 12.3)
//   /// Expect: false
//   printlnv2(set == [1, 2, 3])
  /// Expect: false
  printlnv2(set == #{1, 2, 3, 4})
//   /// Expect: false
//   printlnv2(set == { (1): "a", (2): "b" })
})()

// Set#isEmpty
(() => {
  val set: Set<Int> = #{}
  /// Expect: true
  printlnv2(set.isEmpty())

  set.insert(1)
  /// Expect: false
  printlnv2(set.isEmpty())
})()

// Set#iterator
(() => {
  val s = #{"a", "b", "a", "c"}
  val iter = s.iterator()
  /// Expect: Option.Some(value: "c")
  printlnv2(iter.next())
  /// Expect: Option.Some(value: "b")
  printlnv2(iter.next())
  /// Expect: Option.Some(value: "a")
  printlnv2(iter.next())
  /// Expect: Option.None
  printlnv2(iter.next())
  /// Expect: Option.None
  printlnv2(iter.next())
})()

// For-loops
/// Expect: c 0
/// Expect: b 1
/// Expect: a 2
for ch, idx in #{"a", "b", "c"} {
  printlnv2("$ch $idx")
}

// Set#contains
(() => {
  val set: Set<Int> = #{}
  /// Expect: false
  printlnv2(set.contains(1))

  set.insert(1)
  /// Expect: true
  printlnv2(set.contains(1))
  /// Expect: false
  printlnv2(set.contains(12))
})()

// Set#forEach
(() => {
  val set = #{1, 17, 0, 16}
  /// Expect: 0
  /// Expect: 16
  /// Expect: 1
  /// Expect: 17
  set.forEach(i => printlnv2(i))
})()

// Set#map
(() => {
  val set = #{1, 17, 0, 16}
  /// Expect: [0, 0, 1, 1]
  printlnv2(set.map(i => i % 16))
})()

// Set#filter
(() => {
  val set = #{1, 17, 0, 16}
  /// Expect: #{16, 17}
  printlnv2(set.filter(i => i >= 16))
})()

// Set#asArray
(() => {
  val set1 = #{0, 1, 1, 2, 3, 3, 4}
  /// Expect: [0, 1, 2, 3, 4]
  printlnv2(set1.asArray())
})()

// Set#union
(() => {
  val evens = #{0, 2, 4, 6}
  val odds = #{1, 3, 5, 7}
  /// Expect: #{0, 1, 2, 3, 4, 5, 6, 7}
  printlnv2(evens.union(odds))
  /// Expect: #{0, 1, 2, 3, 4, 5, 6, 7}
  printlnv2(odds.union(evens))
})()

// Set#difference
(() => {
  val set1 = #{1, 2, 3, 4}
  val set2 = #{0, 2, 3, 5}
  /// Expect: #{1, 4}
  printlnv2(set1.difference(set2))
  /// Expect: #{0, 5}
  printlnv2(set2.difference(set1))
})()

// Set#intersection
(() => {
  val set1 = #{1, 2, 3, 4}
  val set2 = #{0, 2, 3, 5}
  /// Expect: #{2, 3}
  printlnv2(set1.intersection(set2))
  /// Expect: #{2, 3}
  printlnv2(set2.intersection(set1))
})()
